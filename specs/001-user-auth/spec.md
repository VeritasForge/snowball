# 기능 명세서: 사용자 인증 및 다중 계정 지원

**기능 브랜치**: `001-user-auth`
**생성일**: 2026-01-05
**상태**: 초안 (Draft)
**입력**: 사용자 요청: "회원가입 및 로그인 기능을 구현합니다. # FE - 현재 대시보드의 우상단에 회원가입 or 로그인 버튼을 만듭니다. - 로그인을 하지 않은 사용자는 대시보드를 사용할 수 있지만 상태를 저장하지 않도록 합니다. # BE - 회원가입 및 로그인 기능을 구현합니다."

## 사용자 시나리오 & 테스트 *(필수)*

### 사용자 스토리 1 - 게스트 접근 및 로컬 저장 (Priority: P1)

게스트(비로그인 사용자)는 회원가입 없이도 제품의 핵심 가치를 경험할 수 있으며, 브라우저를 새로고침하거나 닫았다가 다시 열어도 입력한 포트폴리오 정보가 유지되어야 합니다.

**이 우선순위인 이유**: 즉각적인 가치 제공 및 연속성 있는 사용자 경험을 제공하기 위함입니다.

**독립 테스트**: 브라우저에서 자산을 추가한 후 페이지를 새로고침하거나 브라우저를 껐다 켭니다. 입력했던 데이터가 그대로 남아있는지 확인합니다. (시크릿 창은 제외)

**인수 시나리오**:

1. **Given** 계정이 없는 방문자가, **When** 대시보드에서 자산을 추가하면, **Then** 해당 정보가 브라우저의 로컬 스토리지(Local Storage)에 저장됩니다.
2. **Given** 자산을 입력한 게스트 사용자가, **When** 페이지를 새로고침하거나 브라우저를 다시 열면, **Then** 로컬 스토리지에서 데이터를 불러와 이전에 입력한 상태를 복원합니다.
3. **Given** 로컬 데이터를 가진 게스트 사용자가, **When** 로그인을 완료하면, **Then** 시스템은 서버의 데이터를 우선적으로 불러오며 로컬 데이터와의 충돌을 방지합니다.

---

### 사용자 스토리 2 - 회원가입 및 로그인 (Priority: P2)

사용자가 기기 간 데이터 동기화 및 영구적인 보관을 원할 경우 계정을 생성하고 로그인할 수 있습니다.

**이 우선순위인 이유**: 다중 기기 지원 및 데이터 안전 보장을 위한 핵심 기능입니다.

**인수 시나리오**:

1. **Given** 게스트 사용자가, **When** "회원가입" 또는 "로그인"을 성공하면, **Then** 사용자 세션이 시작되고 개인화된 대시보드로 전환됩니다.
2. **Given** 로그인 직후, **When** 로컬 스토리지와 서버에 각각 다른 데이터가 존재할 경우, **Then** 서버 데이터를 기준으로 대시보드를 갱신하되 필요 시 로컬 데이터를 서버로 마이그레이션할지 묻거나 안전하게 처리합니다.

---

### 사용자 스토리 3 - 인증된 사용자를 위한 서버 동기화 (Priority: P3)

로그인한 사용자의 데이터는 서버(DB)에 실시간으로 저장되어 어떤 환경에서도 동일하게 접근 가능해야 합니다.

**이 우선순위인 이유**: 데이터의 영속성과 기기 간 이동성 보장.

**인수 시나리오**:

1. **Given** 로그인한 사용자가, **When** 데이터를 수정하면, **Then** 변경 사항이 서버 DB에 즉시 저장되며, 이후에는 로컬 스토리지보다 서버 데이터를 우선시합니다.

### 엣지 케이스 (Edge Cases)

- **데이터 충돌**: 로그인 전 로컬에 작성한 내용이 있고, 로그인한 계정에도 이미 데이터가 있는 경우 -> 서버 데이터를 우선 노출하며, 로컬 데이터는 무시하거나 덮어쓰기 전 사용자 확인 절차를 거침(기본값은 서버 우선).
- **로컬 스토리지 용량 초과**: 브라우저 제한으로 로컬 저장이 실패할 경우 -> 사용자에게 데이터가 저장되지 않을 수 있음을 알리고 로그인을 권장함. 단, 사용자가 로그인을 원하지 않는 경우 데이터 저장이 되지 않는 상태(휘발성 모드)로 서비스를 계속 이용할 수 있도록 허용함.

## 요구사항 *(필수)*

### 기능 요구사항 (Functional Requirements)

- **FR-001**: 시스템은 이메일/비밀번호 기반의 회원가입 및 로그인을 지원해야 합니다.
- **FR-002**: **(중요)** 비로그인 사용자의 포트폴리오 상태는 브라우저의 로컬 스토리지(Local Storage)에 자동 저장되어야 합니다.
- **FR-003**: 사용자가 로그인하는 즉시, 시스템은 서버로부터 사용자의 포트폴리오 데이터를 조회해야 합니다.
- **FR-004**: **(데이터 정합성)** 로그인 상태에서는 모든 변경 사항을 서버 DB에 먼저 저장하고 성공 시 응답을 화면에 반영합니다. 로컬 스토리지는 캐시 용도로만 사용하거나 서버 데이터로 동기화합니다.
- **FR-005**: 로그아웃 시, 현재 브라우저의 로컬 스토리지에 남아있는 (직전 사용자) 데이터는 보안을 위해 삭제하거나 접근을 차단해야 합니다.
- **FR-006**: 프론트엔드 우상단에 로그인 상태에 따른 적절한 UI(버튼/프로필)를 노출합니다.

### 핵심 엔티티 (Key Entities)

- **User**: 사용자 계정 정보.
- **Portfolio**: User ID와 연동됨. (Guest의 경우 `userId`가 없으며 로컬 스토리지 키 값으로 관리)

## 성공 기준 *(필수)*

### 측정 가능한 결과 (Measurable Outcomes)

- **SC-001**: 게스트 사용자가 페이지를 새로고침했을 때 데이터 복구 성공률 100%.
- **SC-002**: 로그인 시 서버 데이터 로딩 및 화면 반영이 300ms 이내에 완료되어 로컬 데이터와 교체되는 과정이 매끄러워야 함.
- **SC-003**: 로그인 사용자가 기기를 변경하여 로그인했을 때, 이전 기기에서 저장한 데이터가 즉시 나타나야 함.